{% extends "base.html" %}
{% block title %}Index DB Page{% endblock %}

{% block content %}
<h1>Hello World, This is Flask for DB connection with SQLITE via SQLALCHEMY</h1>
<ul>
    {% for person in people %}
    <li>{{ person }} <button onclick="deletePerson({{ person.pid }})">Delete</button><a style="margin-left:8px" href="{{ url_for('detail', pid =  person.pid ) }}">Details</a></li>
    {% endfor %}
</ul>

<br>
<br>
<br>
<h3>Adding New Person to db</h3><br>
<form action="{{ url_for('index') }}" method="POST">
    <input type="text" name="name" placeholder="Name" required="required" /><br>
    <input type="number" name="age" placeholder="Age" required="required" /><br>
    <input type="text" name="job" placeholder="Job" required="required" /><br>
    <button type="submit" value="Create">Submit</button>
</form>

<script type="text/javascript">
    function deletePerson(pid) {
        fetch('{{ url_for("delete", pid=pid) }}' + pid, {
            method: 'DELETE'
        })
            .then(response => {
                if (response.ok) {
                    window.location.reload()
                }
                else {
                    console.error('Failed to delete', pid)
                }
            })
            .catch(error => {
                console.error('Error during fetching: ', error)
            })
    }
</script>

{% endblock %}